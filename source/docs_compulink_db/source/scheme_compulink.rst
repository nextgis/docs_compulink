.. sectionauthor:: Александр Мурый <amuriy@gmail.com>

.. _compulink_db_schema_compulink:

Описание таблиц схемы compulink
===============================

Таблица хранения информации о проектах строительства
----------------------------------------------------

Данная таблица содержит информацию о крупных проектах строительства, таких как УЦН. 
Данная информация необходима для построения графиков и отчетах, а так же для выявления принадлежности объектов строительства к выделенным проектам.


.. csv-table:: Структура таблицы project
   :header: "Поле", "Тип", "Описание"
   :widths: 40, 30, 30

    id, int, Идентификатор
    name, varchar, Наименование
    "short_name", varchar, Короткое название
    "description", text, Описание
    "root\_resource\_id", int, "ИД ресурса группового слоя, содержащего все объекты строительства"



Таблица хранения информации об объектах строительства
-----------------------------------------------------

Данная таблица содержит информацию по всем объектам строительства. Данные из этой таблицы используются для построения
отчетов, а так же для осуществления выборок в различных фильтрах системы.
Периодически (ежесуточно), при доступности, информация в таблице обновляется из внешней БД.
Структура таблицы максимально повторяет структуру таблиц из внешней БД. Связь со структурами слоев 
объектов строительства осуществляется  через внешний идентифиактор.

.. table:: Структура таблицы construct\_object

   +--------------------------+--------------------------+---------------------------------------+
   | Поле                     | Тип                      | Описание                              |
   +==========================+==========================+=======================================+
   | resource\_id             | int                      | ИД ресурса группового слоя            |
   +--------------------------+--------------------------+---------------------------------------+
   | name                     | varchar                  | Наименование ВОЛС                     |
   +--------------------------+--------------------------+---------------------------------------+
   | external\_id             | varchar                  | Внешний ИД                            |
   +--------------------------+--------------------------+---------------------------------------+
   | district                 | int                      | Район                                 |
   +--------------------------+--------------------------+---------------------------------------+
   | region                   | int                      | Регион                                |
   +--------------------------+--------------------------+---------------------------------------+
   | project\_id              | int                      | ИД проекта                            |
   +--------------------------+--------------------------+---------------------------------------+
   | subcontr\_name           | varchar                  | Подрядчик строительства               |
   +--------------------------+--------------------------+---------------------------------------+
   | start\_build\_date       | Date                     | Строительство ВОЛС (начало)           |
   +--------------------------+--------------------------+---------------------------------------+
   | end\_build\_date         | Date                     | Строительство ВОЛС (окончание)        |
   +--------------------------+--------------------------+---------------------------------------+
   | start\_deliver\_date     | Date                     | Cдача заказчику (начало)              |
   +--------------------------+--------------------------+---------------------------------------+
   | end\_deliver\_date       | Date                     | Cдача заказчику (окончание)           |
   +--------------------------+--------------------------+---------------------------------------+
   | cabling\_plan            | float                    | Прокладка ОК План (км)                |
   +--------------------------+--------------------------+---------------------------------------+
   | fosc\_plan               | int                      | Разварка муфт План (шт)               |
   +--------------------------+--------------------------+---------------------------------------+
   | cross\_plan              | int                      | Разварка кроссов План (шт)            |
   +--------------------------+--------------------------+---------------------------------------+
   | spec\_trans\_plan        | int                      | Строительство ГНБ переходов План (шт) |
   +--------------------------+--------------------------+---------------------------------------+
   | access\_point\_plan      | int                      | Монтаж точек доступа План (шт)        |
   +--------------------------+--------------------------+---------------------------------------+

 
Таблицы хранения информации об АТД
----------------------------------

Таблицы содержат информацию о федеральных округах, регионах и районах РФ. RtMacroDivision и RtBranch содержат 
соответственно макрорегиональные и региональные филиалы Ростелекома. Таблица RegionRtBranch описывает взаимоотношение
регионов к региональным филиалам Ростелекома.

.. table:: Структура таблицы federal\_district

   +--------------------------+--------------------------+--------------------------+
   | Поле                     | Тип                      | Описание                 |
   +==========================+==========================+==========================+
   | id                       | int                      | Идентификатор            |
   +--------------------------+--------------------------+--------------------------+
   | name                     | varchar                  | Наименование             |
   +--------------------------+--------------------------+--------------------------+
   | short_name               | varchar                  | Короткое название        |
   +--------------------------+--------------------------+--------------------------+

.. table:: Структура таблицы region

   +--------------------------+--------------------------+-----------------------------------------------+
   | Поле                     | Тип                      | Описание                                      |
   +==========================+==========================+===============================================+
   | id                       | int                      | Идентификатор                                 |
   +--------------------------+--------------------------+-----------------------------------------------+
   | name                     | varchar                  | Наименование                                  |
   +--------------------------+--------------------------+-----------------------------------------------+
   | short\_name              | varchar                  | Короткое название                             |
   +--------------------------+--------------------------+-----------------------------------------------+
   | region\_code             | int                      | Код региона                                   |
   +--------------------------+--------------------------+-----------------------------------------------+
   | federal\_dist\_id        | int                      | Внешний ключ. Идентификатор родительского ФО  |
   +--------------------------+--------------------------+-----------------------------------------------+

.. table:: Структура таблицы district

   +--------------------------+--------------------------+---------------------------------------------------+
   | Поле                     | Тип                      | Описание                                          |
   +==========================+==========================+===================================================+
   | id                       | int                      | Идентификатор                                     |
   +--------------------------+--------------------------+---------------------------------------------------+
   | name                     | varchar                  | Наименование                                      |
   +--------------------------+--------------------------+---------------------------------------------------+
   | short\_name              | varchar                  | Короткое название                                 |
   +--------------------------+--------------------------+---------------------------------------------------+
   | region\_id               | int                      | Внешний ключ. Идентификатор родительского региона |
   +--------------------------+--------------------------+---------------------------------------------------+

.. table:: Структура таблицы rt\_macro\_division

   +--------------------------+--------------------------+----------------------------------------------------+
   | Поле                     | Тип                      | Описание                                           |
   +==========================+==========================+====================================================+
   | id                       | int                      | Идентификатор                                      |
   +--------------------------+--------------------------+----------------------------------------------------+
   | name                     | varchar                  | Наименование Макрорегионального филиал Ростелекома |
   +--------------------------+--------------------------+----------------------------------------------------+
   | short\_name              | varchar                  | Короткое название                                  |
   +--------------------------+--------------------------+----------------------------------------------------+

.. table:: Структура таблицы rt\_branch

   +-----------------------+---------+----------------------------------------+
   | Поле                  | Тип     | Описание                               |
   +=======================+=========+========================================+
   | id                    | int     | Идентификатор                          |
   +-----------------------+---------+----------------------------------------+
   | name                  | varchar | Наименование Регионального филиала     |
   |                       |         |                                        |
   |                       |         | Ростелекома                            |
   +-----------------------+---------+----------------------------------------+
   | short_name            | varchar | Короткое название                      |
   +-----------------------+---------+----------------------------------------+
   | ``macro_division_id`` | int     | Внешний ключ. Идентификатор            |
   |                       |         |                                        |
   |                       |         | макрорегионального филиала Ростелекома |
   |                       |         |                                        |
   +-----------------------+---------+----------------------------------------+

.. table:: Структура таблицы rt\_branch\_region

   +-------------------+-------+--------------------------------------------+
   | Поле              | Тип   | Описание                                   |
   +===================+=======+============================================+
   | ``region_id``     | int   | Внешний ключ. Идентификатор субъекта РФ    |
   +-------------------+-------+--------------------------------------------+
   | ``rt_branch_id``  | int   | Внешний ключ. Идентификатор регионального  |
   |                   |       |                                            |
   |                   |       | филиала Ростелекома                        |
   +-------------------+-------+--------------------------------------------+
   

Таблицы хранения информации о ежедневном ходе строительства
-----------------------------------------------------------

Таблицы содержат данные по результатам ежедневной подсчета выполненных работ по каждому объекту строительства. 
Для каждого элемента строительства информацию хранится в разрезе основных характеристик.
Справочники, используемые в данных таблицах описаны в разделе Справочники.

.. table:: Структура таблицы built\_fosc

   +--------------------------+--------------------------+----------------------------+
   | Поле                     | Тип                      | Описание                   |
   +==========================+==========================+============================+
   | id                       | int                      | Идентификатор              |
   +--------------------------+--------------------------+----------------------------+
   | resource\_id             | int                      | ИД ресурса группового слоя |
   |                          |                          | (ид объекта строительства) |
   |                          |                          |                            |
   +--------------------------+--------------------------+----------------------------+
   | build\_date              | int                      | Дата строительства.        |
   |                          |                          | Справочник                 |
   +--------------------------+--------------------------+----------------------------+
   | fosc\_count              | int                      | Кол-во развараренных муфт  |
   |                          |                          | (шт)                       |
   +--------------------------+--------------------------+----------------------------+
   | fosc\_type               | text                     | Тип муфты. Справочник      |
   +--------------------------+--------------------------+----------------------------+

.. table:: Структура таблицы built\_cable

   +--------------------------+--------------------------+----------------------------+
   | Поле                     | Тип                      | Описание                   |
   +==========================+==========================+============================+
   | id                       | int                      | Идентификатор              |
   +--------------------------+--------------------------+----------------------------+
   | resource\_id             | int                      | ИД ресурса группового слоя |
   |                          |                          | (ид объекта строительства) |
   |                          |                          |                            |
   +--------------------------+--------------------------+----------------------------+
   | build\_date              | int                      | Дата строительства.        |
   |                          |                          | Справочник                 |
   +--------------------------+--------------------------+----------------------------+
   | cable\_length            | float                    | Прокладка ОК (км)          |
   +--------------------------+--------------------------+----------------------------+
   | laying\_method           | text                     | Способ прокладки.          |
   |                          |                          | Справочник                 |
   +--------------------------+--------------------------+----------------------------+

.. table:: Структура таблицы built\_optical\_cross

   +------------------------+------+----------------------------+
   | Поле                   | Тип  | Описание                   |
   +========================+======+============================+
   | id                     | int  | Идентификатор              |
   +------------------------+------+----------------------------+
   | resource\_id           | int  | ИД ресурса группового слоя |
   |                        |      | (ид объекта строительства) |
   +------------------------+------+----------------------------+
   | build\_date            | int  | Дата строительства.        |
   |                        |      | Справочник                 |
   +------------------------+------+----------------------------+
   | optical\_cross\_count  | int  | Кол-во разваренных кроссов |
   |                        |      | (шт)                       |
   +------------------------+------+----------------------------+
   | optical\_cross\_type   | text | Тип кросса. Справочник     |
   +------------------------+------+----------------------------+

.. table:: Структура таблицы built\_spec\_transition

   +----------------------+--------------------------+--------------------------+
   | Поле                 | Тип                      | Описание                 |
   +======================+==========================+==========================+
   | id                   | int                      | Идентификатор            |
   +----------------------+--------------------------+--------------------------+
   | resource\_id         | int                      | ИД ресурса группового сл |
   |                      |                          | оя (ид объекта строитель |
   |                      |                          | ства)                    |
   +----------------------+--------------------------+--------------------------+
   | build\_date          | int                      | Дата строительства. Спра |
   |                      |                          | вочник                   |
   +----------------------+--------------------------+--------------------------+
   | spec\_trans\_length  | int                      | Прокладка спец. переходо |
   |                      |                          | в (км)                   |
   +----------------------+--------------------------+--------------------------+
   | spec\_laying\_method | text                     | Способ прокладки кабеля. |
   |                      |                          |  Справочник              |
   +----------------------+--------------------------+--------------------------+
   | spec\_trans\_count   | int                      | Количество спец переходо |
   |                      |                          | в                        |
   +----------------------+--------------------------+--------------------------+

.. table:: Структура таблицы built\_access\_point

   +--------------------------+--------------------------+--------------------------+
   | Поле                     | Тип                      | Описание                 |
   +==========================+==========================+==========================+
   | id                       | int                      | Идентификатор            |
   +--------------------------+--------------------------+--------------------------+
   | resource\_id             | int                      | ИД ресурса группового сл |
   |                          |                          | оя (ид объекта строитель |
   |                          |                          | ства)                    |
   +--------------------------+--------------------------+--------------------------+
   | build\_date              | int                      | Дата строительства. Спра |
   |                          |                          | вочник                   |
   +--------------------------+--------------------------+--------------------------+
   | access\_point\_count     | int                      | Кол-во установленных точ |
   |                          |                          | ек доступа (шт)          |
   +--------------------------+--------------------------+--------------------------+
   | access\_point\_type      | text                     | Тип кросса. Справочник   |
   +--------------------------+--------------------------+--------------------------+


Таблицы хранения справочников
-----------------------------
Таблицы, структура которых приведена ниже, используются для хранения справочных типов, используемых в других таблицах.

.. table:: Структура таблицы calendar

   +--------------------------+--------------------------+--------------------------+
   | Поле                     | Тип                      | Описание                 |
   +==========================+==========================+==========================+
   | id                       | int                      | Идентификатор            |
   +--------------------------+--------------------------+--------------------------+
   | full\_date               | date                     | Полная дата              |
   +--------------------------+--------------------------+--------------------------+
   | year\_number             | smallint                 | Год                      |
   +--------------------------+--------------------------+--------------------------+
   | semester\_number         | smallint                 | Номер полугодия          |
   +--------------------------+--------------------------+--------------------------+
   | semester\_name           | nvarchar                 | Название полугодия       |
   +--------------------------+--------------------------+--------------------------+
   | quarter\_number          | smallint                 | Номер квартала           |
   +--------------------------+--------------------------+--------------------------+
   | quarter\_name            | nvarchar                 | Название квартала        |
   +--------------------------+--------------------------+--------------------------+
   | month\_number            | smallint                 | Номер месяца             |
   +--------------------------+--------------------------+--------------------------+
   | month\_name              | nvarchar                 | Название месяца          |
   +--------------------------+--------------------------+--------------------------+
   | year\_week\_number       | smallint                 | Номер недели в году      |
   +--------------------------+--------------------------+--------------------------+
   | month\_week\_number      | smallint                 | Номер недели в месяце    |
   +--------------------------+--------------------------+--------------------------+
   | month\_decade\_number    | smallint                 | Номер недели в декаде    |
   +--------------------------+--------------------------+--------------------------+
   | year\_day\_number        | smallint                 | Номер дня в году         |
   +--------------------------+--------------------------+--------------------------+
   | month\_day\_number       | smallint                 | Номер дня в месяце       |
   +--------------------------+--------------------------+--------------------------+
   | week\_day\_number        | smallint                 | Номер дня в недели       |
   +--------------------------+--------------------------+--------------------------+
   | week\_day\_name          | nvarchar                 | Название дня недели      |
   +--------------------------+--------------------------+--------------------------+
   | week\_day\_short\_name   | nvarchar                 | Короткое название дня    |
   |                          |                          | недели                   |
   +--------------------------+--------------------------+--------------------------+
   | weekend                  | bit                      | Выходной                 |
   +--------------------------+--------------------------+--------------------------+

.. table:: Структура таблицы access\_point\_type

   +--------------------------+--------------------------+--------------------------+
   | Поле                     | Тип                      | Описание                 |
   +==========================+==========================+==========================+
   | id                       | int                      | Идентификатор            |
   +--------------------------+--------------------------+--------------------------+
   | description              | text                     | Описаение                |
   +--------------------------+--------------------------+--------------------------+
   | type                     | varchar                  | Тип точки доступа        |
   +--------------------------+--------------------------+--------------------------+

.. table:: Структура таблицы cable\_laying\_method

   +--------------------------+--------------------------+--------------------------+
   | Поле                     | Тип                      | Описание                 |
   +==========================+==========================+==========================+
   | id                       | int                      | Идентификатор            |
   +--------------------------+--------------------------+--------------------------+
   | description              | text                     | Описаение                |
   +--------------------------+--------------------------+--------------------------+
   | method                   | varchar                  | Метод прокладки кабеля   |
   +--------------------------+--------------------------+--------------------------+

.. table:: Структура таблицы fosc\_type

   +--------------------------+--------------------------+--------------------------+
   | Поле                     | Тип                      | Описание                 |
   +==========================+==========================+==========================+
   | id                       | int                      | Идентификатор            |
   +--------------------------+--------------------------+--------------------------+
   | description              | text                     | Описаение                |
   +--------------------------+--------------------------+--------------------------+
   | type                     | varchar                  | Тип оптической муфты     |
   +--------------------------+--------------------------+--------------------------+

.. table:: Структура таблицы optical\_cross\_type

   +--------------------------+--------------------------+--------------------------+
   | Поле                     | Тип                      | Описание                 |
   +==========================+==========================+==========================+
   | id                       | int                      | Идентификатор            |
   +--------------------------+--------------------------+--------------------------+
   | description              | text                     | Описаение                |
   +--------------------------+--------------------------+--------------------------+
   | type                     | varchar                  | Тип оптического кросса   |
   +--------------------------+--------------------------+--------------------------+

.. table:: Структура таблицы spec\_laying\_method

   +--------------------------+--------------------------+--------------------------+
   | Поле                     | Тип                      | Описание                 |
   +==========================+==========================+==========================+
   | id                       | int                      | Идентификатор            |
   +--------------------------+--------------------------+--------------------------+
   | description              | text                     | Описаение                |
   +--------------------------+--------------------------+--------------------------+
   | method                   | varchar                  | Тип спецперехода         |
   +--------------------------+--------------------------+--------------------------+
   

Таблица хранения информации об отклонениях при строительстве
------------------------------------------------------------

Таблица содержит сводную информацию об отклонениях, допущенных при строительстве объектов. 
Данные из этой таблицы используются для построения отчета об отклонениях.

.. table:: Структура таблицы construct\_deviation

   +--------------------------+--------------------------+--------------------------------------+
   | Поле                     | Тип                      | Описание                             |
   +==========================+==========================+======================================+
   | id                       | int                      | Идентификатор                        |
   +--------------------------+--------------------------+--------------------------------------+
   | focl\_res\_id            | int                      | Идентификатор ресурса                |
   +--------------------------+--------------------------+--------------------------------------+
   | focl\_name               | varchar                  | Название объекта строительства       |
   +--------------------------+--------------------------+--------------------------------------+
   | object\_type             | varchar                  | Тип объекта с отклонением            |
   +--------------------------+--------------------------+--------------------------------------+
   | object\_num              | int                      | Номер объекта с отклонением          |
   +--------------------------+--------------------------+--------------------------------------+
   | deviation\_distance      | int                      | Расстояние отклонения, м             |
   +--------------------------+--------------------------+--------------------------------------+
   | deviation\_approved      | bool                     | Отклонение утверждено                |
   +--------------------------+--------------------------+--------------------------------------+
   | approval\_comment        | varchar                  | Комментарий к утверждению отклонения |
   +--------------------------+--------------------------+--------------------------------------+
   | approval\_author         | varchar                  | Пользователь, утвердивший отклонение |
   +--------------------------+--------------------------+--------------------------------------+
   | approval\_timestamp      | timestamp                | Дата и время утверждения отклонения  |
   +--------------------------+--------------------------+--------------------------------------+
   

Таблица хранения информации о статусе строительства
---------------------------------------------------

Таблица содержит сводную информацию о всех объектах строительства и текущем состоянии этих объектов. 
Данные из этой таблицы используются для построения отчета о статусе строительства.

.. table:: Структура таблицы status\_report

   +--------------------------+-----------+------------------------------------------+
   | Поле                     | Тип       | Описание                                 |
   +==========================+===========+==========================================+
   | id                       | int       | Идентификатор                            |
   +--------------------------+-----------+------------------------------------------+
   | focl\_res\_id            | int       | Идентификатор ресурса                    |
   +--------------------------+-----------+------------------------------------------+
   | focl\_name               | varchar   | Название объекта строительства           |
   +--------------------------+-----------+------------------------------------------+
   | region                   | int       | Регион                                   |
   +--------------------------+-----------+------------------------------------------+
   | district                 | int       | Район                                    |
   +--------------------------+-----------+------------------------------------------+
   | status                   | varchar   | Статус строительства                     |
   +--------------------------+-----------+------------------------------------------+
   | subcontr\_name           | varchar   | Подрядчик строительства                  |
   +--------------------------+-----------+------------------------------------------+
   | start\_build\_time       | timestamp | Строительство ВОЛС (начало)              |
   +--------------------------+-----------+------------------------------------------+
   | end\_build\_time         | timestamp | Строительство ВОЛС (окончание)           |
   +--------------------------+-----------+------------------------------------------+
   | start\_deliver\_time     | timestamp | Cдача заказчику (начало)                 |
   +--------------------------+-----------+------------------------------------------+
   | end\_deliver\_time       | timestamp | Cдача заказчику (окончание)              |
   +--------------------------+-----------+------------------------------------------+
   | cabling\_plan            | double    | Прокладка ОК. План (км)                  |
   +--------------------------+-----------+------------------------------------------+
   | cabling\_fact            | double    | Прокладка ОК. Факт (км)                  |
   +--------------------------+-----------+------------------------------------------+
   | cabling\_percent         | int       | Прокладка ОК.                            |
   |                          |           | Процент выполнения (%)                   |
   +--------------------------+-----------+------------------------------------------+
   | fosc\_plan               | int       | Разварка муфт. План (шт)                 |
   +--------------------------+-----------+------------------------------------------+
   | fosc\_fact               | int       | Разварка муфт. Факт (шт)                 |
   +--------------------------+-----------+------------------------------------------+
   | fosc\_percent            | int       | Разварка муфт.                           |
   |                          |           | Процент выполнения (%)                   |
   +--------------------------+-----------+------------------------------------------+
   | cross\_plan              | int       | Разварка кроссов. План (шт)              |
   +--------------------------+-----------+------------------------------------------+
   | cross\_fact              | int       | Разварка кроссов. Факт (шт)              |
   +--------------------------+-----------+------------------------------------------+
   | cross\_percent           | int       | Разварка кроссов.                        |
   |                          |           | Процент выполнения (%)                   |
   +--------------------------+-----------+------------------------------------------+
   | spec\_trans\_plan        | int       | Строительство ГНБ переходов.             |
   |                          |           | План (шт)                                |
   +--------------------------+-----------+------------------------------------------+
   | spec\_trans\_fact        | int       | Строительство ГНБ переходов.             |
   |                          |           | Факт (шт)                                |
   +--------------------------+-----------+------------------------------------------+
   | spec\_trans\_percent     | int       | Строительство ГНБ переходов.             |
   |                          |           | Процент выполнения (%)                   |
   +--------------------------+-----------+------------------------------------------+
   | ap\_plan                 | int       | Монтаж точек доступа. План (шт)          |
   +--------------------------+-----------+------------------------------------------+
   | ap\_fact                 | int       | Монтаж точек доступа. Факт (шт)          |
   +--------------------------+-----------+------------------------------------------+
   | ap\_percent              | int       | Монтаж точек доступа.                    |
   |                          |           | Процент выполнения (%)                   |
   +--------------------------+-----------+------------------------------------------+
   | is\_overdue              | bool      | Просрочена дата сдачи                    |
   +--------------------------+-----------+------------------------------------------+
   | is\_month\_overdue       | bool      | Просрочена дата сдачи более чем на месяц |
   +--------------------------+-----------+------------------------------------------+
